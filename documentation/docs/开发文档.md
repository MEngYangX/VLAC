# Vespera Lumen AntiCheat (VLAC) 开发文档

## 项目概述
Vespera Lumen AntiCheat（VLAC）是一个为Minecraft开发的基于Fabric的反作弊模组。该模组旨在检测和防止各种作弊行为，保护服务器的公平性和玩家体验。

## 项目目标
- 检测和防止常见的作弊行为（如飞行、速度修改、自动点击等）
- 提供灵活的配置选项，使服务器管理员可以根据需要自定义反作弊规则
- 最小化对正常玩家的影响，减少误判
- 提供详细的日志和报告系统，方便管理员监控和分析可疑行为
- 与Minecraft版本1.21.5兼容
- **支持LuckPerms权限系统**，实现基于权限的反作弊控制

## 技术架构

### 核心组件
1. **检测系统**：负责监控和分析玩家行为，识别潜在的作弊行为
2. **处罚系统**：根据配置对检测到的作弊行为执行相应的处罚
3. **配置系统**：提供灵活的配置选项，允许管理员自定义检测和处罚规则
4. **日志系统**：记录检测到的作弊行为和执行的处罚
5. **权限系统**：集成LuckPerms，提供基于权限的功能控制和检测豁免

### 文件结构
```
src/
├── main/                    # 主要代码
│   ├── kotlin/              # Kotlin源代码
│   │   └── com/mengyangx/vlac/
│   │       ├── VesperaLumenAntiCheat.kt       # 主类
│   │       ├── detection/                      # 检测系统
│   │       ├── punishment/                     # 处罚系统
│   │       ├── config/                         # 配置系统
│   │       └── util/                           # 工具类
│   │           └── PermissionUtils.kt          # 权限工具类
│   └── resources/           # 资源文件
│       ├── fabric.mod.json  # Fabric模组配置
│       └── assets/          # 模组资源
└── client/                  # 客户端专用代码
    └── kotlin/
        └── com/mengyangx/vlac/
            └── VesperaLumenAntiCheatClient.kt  # 客户端主类
```

## 实现方式

### 检测系统
检测系统将利用Fabric API提供的事件和钩子来监控玩家行为。主要检测类型包括：

1. **移动检测**：检测不合理的移动速度、飞行等
2. **战斗检测**：检测自动点击、攻击范围异常等
3. **交互检测**：检测与方块和实体的异常交互
4. **其他检测**：如聊天行为分析等

每种检测都将有独立的检测器类，负责分析特定类型的行为并判断是否为作弊。

### 处罚系统
处罚系统提供多种处罚方式，包括：

1. 警告玩家
2. 踢出服务器
3. 暂时封禁
4. 永久封禁
5. 命令执行

服务器管理员可以为不同的作弊行为配置不同的处罚方式和级别。

### 配置系统
配置系统使用JSON格式，允许管理员自定义：

1. 每种检测的启用/禁用状态
2. 检测灵敏度和阈值
3. 处罚方式和级别
4. 日志记录级别
5. **权限设置**：LuckPerms集成配置

### 日志系统
日志系统将记录所有检测到的可疑行为和执行的处罚，包括时间、玩家名、行为类型、处罚类型等信息。日志可以保存到文件或发送到管理员。

### 权限系统
VLAC集成了LuckPerms权限系统，提供以下功能：

1. **基于权限的检测豁免**：管理员可以为特定玩家或权限组设置检测豁免
2. **基于权限的命令访问**：限制特定玩家使用VLAC管理命令
3. **基于权限组的处罚差异化**：为不同权限组设置不同的处罚规则

#### 权限节点
VLAC使用以下权限节点：

| 权限节点 | 描述 |
|---------|------|
| `vlac.admin` | 完全访问VLAC的所有功能 |
| `vlac.command.*` | 使用所有VLAC命令的权限 |
| `vlac.command.<命令名>` | 使用特定VLAC命令的权限 |
| `vlac.bypass.all` | 绕过所有检测 |
| `vlac.bypass.<检测类型>` | 绕过特定类型的检测 |
| `vlac.notifications` | 接收违规通知 |

## 使用方法
1. 将模组JAR文件放入服务器的mods文件夹
2. 启动服务器，模组将自动生成默认配置文件
3. 根据需要编辑配置文件，自定义检测和处罚规则
4. 重启服务器，应用新的配置

### 配置LuckPerms集成
1. 确保服务器已安装LuckPerms模组
2. 在VLAC配置文件中，找到`permissions`部分
3. 设置`useLuckPerms: true`启用LuckPerms集成
4. 在`bypassGroups`列表中添加豁免组名称
5. 使用LuckPerms命令为玩家或组分配VLAC权限

示例权限命令：
```
/lp user <玩家名> permission set vlac.bypass.fly true
/lp group admin permission set vlac.admin true
```

## 开发计划
1. **阶段1**：实现基本框架和配置系统
2. **阶段2**：实现核心检测系统（移动、战斗）
3. **阶段3**：实现处罚系统和日志系统
4. **阶段4**：添加更多检测类型和优化
5. **阶段5**：完善文档和测试

## 当前状态
项目目前处于初始开发阶段，基本框架已经建立。已完成LuckPerms权限系统集成，支持基于权限的反作弊控制。 